package com.mtv.erp.utils;

import com.google.gson.Gson;
import com.google.gson.reflect.TypeToken;
import com.mtv.erp.exception.ErrorCode;
import com.mtv.erp.exception.ServerException;
import com.mtv.erp.model.LaborRecord;
import com.mtv.erp.mybatis.daoimpl.HoursDaoImpl;
import com.mtv.erp.response.planfixResponse.PlanfixLaborRecord;
import com.mtv.erp.response.planfixResponse.PlanfixUser;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.lang.reflect.Type;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

public class Planfix {
    private static final Logger LOGGER = LoggerFactory.getLogger(Planfix.class);

    public List<PlanfixUser> getUsers() throws ServerException {
        String cmd = "getUsers";
        try {
            Runtime rt = Runtime.getRuntime() ;
            LOGGER.debug("Planfix: " + cmd);
            Process p = rt.exec("./planfix/PlanFix.Console.exe " + cmd) ;
            InputStream in = p.getInputStream();
            BufferedReader br = new BufferedReader(new InputStreamReader(in));
            StringBuilder str = new StringBuilder();
            String line;
            while ((line = br.readLine()) != null){
                str.append(line);
            }
            p.destroy() ;
            System.out.println(str);
            Gson gson = new Gson();
            Type listType = new TypeToken<ArrayList<PlanfixUser>>(){}.getType();
            return gson.fromJson(str.toString(), listType);
        }
        catch(Exception exc)
        {
            throw new ServerException(ErrorCode.PLANFIX_CANT_GET_USERS);
        }
    }

    public String getProjects(String status) throws ServerException{
        String cmd = "getProjects ";
        try {
            Runtime rt = Runtime.getRuntime() ;
            LOGGER.debug("Planfix: " + cmd + status);
            Process p = rt.exec("./planfix/PlanFix.Console.exe " + cmd + status) ;
            InputStream in = p.getInputStream();
            BufferedReader br = new BufferedReader(new InputStreamReader(in));
            StringBuilder str = new StringBuilder();
            String line;
            while ((line = br.readLine()) != null){
                str.append(line);
            }
            p.destroy() ;
            System.out.println(str);
            Gson gson = new Gson();
            Type listType = new TypeToken<ArrayList<PlanfixUser>>(){}.getType();
            return str.toString();
        }
        catch(Exception exc)
        {
            throw new ServerException(ErrorCode.PLANFIX_CANT_GET_USERS);
        }
    }

    public List<PlanfixLaborRecord> getHours(LocalDate from, LocalDate to) throws ServerException {
        String fromMonth = (from.getMonthValue()<10)?"0" + from.getMonthValue():String.valueOf(from.getMonthValue());
        String toMonth = (to.getMonthValue()<10)?"0" + to.getMonthValue():String.valueOf(to.getMonthValue());
        String fromString = from.getYear() + "-" + fromMonth + "-" + from.getDayOfMonth();
        String toString = to.getYear() + "-" + toMonth + "-" + to.getDayOfMonth();
        String cmd = "getLaborRecords ";
        try {
            Runtime rt = Runtime.getRuntime() ;
            LOGGER.debug("Planfix: " + cmd + fromString + " " + toString);
            Process p = rt.exec("./planfix/PlanFix.Console.exe " + cmd + fromString + " " + toString) ;
            InputStream in = p.getInputStream();
            BufferedReader br = new BufferedReader(new InputStreamReader(in));
            StringBuilder str = new StringBuilder();
            String line;
            while ((line = br.readLine()) != null){
                str.append(line);
            }
           // String str = "[  {    \"FirstName\": \"Михаил\",    \"LastName\": \"Баранцев\",    \"StartTime\": \"0001-01-01T00:00:00\",    \"FinishTime\": \"0001-01-01T00:00:00\",    \"LaborSpan\": \"00:00:00\",    \"TaskId\": 22519684,    \"TaskTitle\": \"Выполнить ПНР дозатора 1 линии\",    \"ProjectId\": 724236,    \"ProjectTitle\": \"АС00-124 Линия ввода зерна\"  },  {    \"FirstName\": \"Михаил\",    \"LastName\": \"Баранцев\",    \"StartTime\": \"0001-01-01T00:00:00\",    \"FinishTime\": \"0001-01-01T00:00:00\",    \"LaborSpan\": \"00:00:00\",    \"TaskId\": 22519684,    \"TaskTitle\": \"Выполнить ПНР дозатора 1 линии\",    \"ProjectId\": 724236,    \"ProjectTitle\": \"АС00-124 Линия ввода зерна\"  },  {    \"FirstName\": \"Михаил\",    \"LastName\": \"Баранцев\",    \"StartTime\": \"2021-01-04T00:00:00\",    \"FinishTime\": \"2021-01-04T02:00:00\",    \"LaborSpan\": \"02:00:00\",    \"TaskId\": 22519684,    \"TaskTitle\": \"Выполнить ПНР дозатора 1 линии\",    \"ProjectId\": 724236,    \"ProjectTitle\": \"АС00-124 Линия ввода зерна\"  },  {    \"FirstName\": \"Талгат\",    \"LastName\": \"Ракишев\",    \"StartTime\": \"2021-01-06T09:00:00\",    \"FinishTime\": \"2021-01-06T17:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22519532,    \"TaskTitle\": \"Доработать ППО\",    \"ProjectId\": 724226,    \"ProjectTitle\": \"АС00-104. Поставка, монтаж и ПНР автоматизированных систем ПАЗ АХУ-1 и АХУ-2\"  },  {    \"FirstName\": \"Талгат\",    \"LastName\": \"Ракишев\",    \"StartTime\": \"2021-01-11T09:00:00\",    \"FinishTime\": \"2021-01-11T17:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22519532,    \"TaskTitle\": \"Доработать ППО\",    \"ProjectId\": 724226,    \"ProjectTitle\": \"АС00-104. Поставка, монтаж и ПНР автоматизированных систем ПАЗ АХУ-1 и АХУ-2\"  },  {    \"FirstName\": \"Наталья\",    \"LastName\": \"Скакун\",    \"StartTime\": \"2021-01-11T08:00:00\",    \"FinishTime\": \"2021-01-11T16:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22514030,    \"TaskTitle\": \"Заполнение шаблонов установки 43-103 часть 2\",    \"ProjectId\": 723794,    \"ProjectTitle\": \"АС00-2 Формирование актуальной базы приборов КИП\"  },  {    \"FirstName\": \"Алексей\",    \"LastName\": \"Евлеев\",    \"StartTime\": \"2021-01-11T08:20:00\",    \"FinishTime\": \"2021-01-11T10:50:00\",    \"LaborSpan\": \"02:30:00\",    \"TaskId\": 22519662,    \"TaskTitle\": \"Разработать ППО часть 3\",    \"ProjectId\": 724236,    \"ProjectTitle\": \"АС00-124 Линия ввода зерна\"  },  {    \"FirstName\": \"Алексей\",    \"LastName\": \"Евлеев\",    \"StartTime\": \"2021-01-11T14:00:00\",    \"FinishTime\": \"2021-01-11T18:00:00\",    \"LaborSpan\": \"04:00:00\",    \"TaskId\": 22519662,    \"TaskTitle\": \"Разработать ППО часть 3\",    \"ProjectId\": 724236,    \"ProjectTitle\": \"АС00-124 Линия ввода зерна\"  },  {    \"FirstName\": \"Виталий\",    \"LastName\": \"Тимохов\",    \"StartTime\": \"2021-01-11T08:00:00\",    \"FinishTime\": \"2021-01-11T16:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22519808,    \"TaskTitle\": \"Диспетчеризация разведочно-эксплутационной скважины в р.п. Нововаршавка Омской области.\",    \"ProjectId\": 724436,    \"ProjectTitle\": \"АС00-214 Диспетчеризация скважины\"  },  {    \"FirstName\": \"Владислав\",    \"LastName\": \"Сузенко\",    \"StartTime\": \"2021-01-11T14:00:00\",    \"FinishTime\": \"2021-01-11T17:00:00\",    \"LaborSpan\": \"03:00:00\",    \"TaskId\": 22509820,    \"TaskTitle\": \"Произвести тестирование программного обеспечения\",    \"ProjectId\": 713482,    \"ProjectTitle\": \"2606-1 Система умного отвешивания\"  },  {    \"FirstName\": \"Алексей\",    \"LastName\": \"Евлеев\",    \"StartTime\": \"2021-01-12T07:30:00\",    \"FinishTime\": \"2021-01-12T11:30:00\",    \"LaborSpan\": \"04:00:00\",    \"TaskId\": 22519662,    \"TaskTitle\": \"Разработать ППО часть 3\",    \"ProjectId\": 724236,    \"ProjectTitle\": \"АС00-124 Линия ввода зерна\"  },  {    \"FirstName\": \"Алексей\",    \"LastName\": \"Евлеев\",    \"StartTime\": \"2021-01-12T12:00:00\",    \"FinishTime\": \"2021-01-12T17:30:00\",    \"LaborSpan\": \"05:30:00\",    \"TaskId\": 22519662,    \"TaskTitle\": \"Разработать ППО часть 3\",    \"ProjectId\": 724236,    \"ProjectTitle\": \"АС00-124 Линия ввода зерна\"  },  {    \"FirstName\": \"Мейрам\",    \"LastName\": \"Бисимбеков\",    \"StartTime\": \"0001-01-01T00:00:00\",    \"FinishTime\": \"0001-01-01T00:00:00\",    \"LaborSpan\": \"00:00:00\",    \"TaskId\": 22515736,    \"TaskTitle\": \"Произвести тестирование программного обеспечения\",    \"ProjectId\": 724236,    \"ProjectTitle\": \"АС00-124 Линия ввода зерна\"  },  {    \"FirstName\": \"Мейрам\",    \"LastName\": \"Бисимбеков\",    \"StartTime\": \"2021-01-03T09:00:00\",    \"FinishTime\": \"2021-01-03T14:00:00\",    \"LaborSpan\": \"05:00:00\",    \"TaskId\": 22515736,    \"TaskTitle\": \"Произвести тестирование программного обеспечения\",    \"ProjectId\": 724236,    \"ProjectTitle\": \"АС00-124 Линия ввода зерна\"  },  {    \"FirstName\": \"Мейрам\",    \"LastName\": \"Бисимбеков\",    \"StartTime\": \"2021-01-10T09:00:00\",    \"FinishTime\": \"2021-01-10T17:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22519278,    \"TaskTitle\": \"Замена серверов на БРУ-1 (2)\",    \"ProjectId\": 724422,    \"ProjectTitle\": \"АС00-183 Модернизация системы управления БРУ 1,2\"  },  {    \"FirstName\": \"Мейрам\",    \"LastName\": \"Бисимбеков\",    \"StartTime\": \"2021-01-11T09:00:00\",    \"FinishTime\": \"2021-01-11T18:00:00\",    \"LaborSpan\": \"09:00:00\",    \"TaskId\": 22519278,    \"TaskTitle\": \"Замена серверов на БРУ-1 (2)\",    \"ProjectId\": 724422,    \"ProjectTitle\": \"АС00-183 Модернизация системы управления БРУ 1,2\"  },  {    \"FirstName\": \"Наталья\",    \"LastName\": \"Скакун\",    \"StartTime\": \"2021-01-12T08:00:00\",    \"FinishTime\": \"2021-01-12T16:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22514030,    \"TaskTitle\": \"Заполнение шаблонов установки 43-103 часть 2\",    \"ProjectId\": 723794,    \"ProjectTitle\": \"АС00-2 Формирование актуальной базы приборов КИП\"  },  {    \"FirstName\": \"Мейрам\",    \"LastName\": \"Бисимбеков\",    \"StartTime\": \"2021-01-12T09:00:00\",    \"FinishTime\": \"2021-01-12T15:00:00\",    \"LaborSpan\": \"06:00:00\",    \"TaskId\": 22519278,    \"TaskTitle\": \"Замена серверов на БРУ-1 (2)\",    \"ProjectId\": 724422,    \"ProjectTitle\": \"АС00-183 Модернизация системы управления БРУ 1,2\"  },  {    \"FirstName\": \"Мейрам\",    \"LastName\": \"Бисимбеков\",    \"StartTime\": \"2021-01-12T16:00:00\",    \"FinishTime\": \"2021-01-12T18:00:00\",    \"LaborSpan\": \"02:00:00\",    \"TaskId\": 22508538,    \"TaskTitle\": \"Разработать программного кода Системы взвешивания и погрузки на вагонных весах установки замедленного коксования\",    \"ProjectId\": 723774,    \"ProjectTitle\": \"0402-1 Взвешивание 21/10 (УЗК), УПНК ОНПЗ\"  },  {    \"FirstName\": \"Владислав\",    \"LastName\": \"Сузенко\",    \"StartTime\": \"2021-01-12T10:40:00\",    \"FinishTime\": \"2021-01-12T17:00:00\",    \"LaborSpan\": \"06:20:00\",    \"TaskId\": 22509820,    \"TaskTitle\": \"Произвести тестирование программного обеспечения\",    \"ProjectId\": 713482,    \"ProjectTitle\": \"2606-1 Система умного отвешивания\"  },  {    \"FirstName\": \"Никита\",    \"LastName\": \"Вычужанин\",    \"StartTime\": \"2021-01-11T09:00:00\",    \"FinishTime\": \"2021-01-11T17:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22515962,    \"TaskTitle\": \"Изучить C#\",    \"ProjectId\": 724230,    \"ProjectTitle\": \"3333-1 ИПР отдела ОПиСИ\"  },  {    \"FirstName\": \"Никита\",    \"LastName\": \"Вычужанин\",    \"StartTime\": \"2021-01-12T09:00:00\",    \"FinishTime\": \"2021-01-12T17:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22515962,    \"TaskTitle\": \"Изучить C#\",    \"ProjectId\": 724230,    \"ProjectTitle\": \"3333-1 ИПР отдела ОПиСИ\"  },  {    \"FirstName\": \"Мейрам\",    \"LastName\": \"Бисимбеков\",    \"StartTime\": \"2021-01-13T09:30:00\",    \"FinishTime\": \"2021-01-13T12:30:00\",    \"LaborSpan\": \"03:00:00\",    \"TaskId\": 22519428,    \"TaskTitle\": \"Устранение сбоев в работе СУ БРУ1,2\",    \"ProjectId\": 724420,    \"ProjectTitle\": \"АС00-202 Сервисное обслуживание БРУ 1,2\"  },  {    \"FirstName\": \"Алексей\",    \"LastName\": \"Евлеев\",    \"StartTime\": \"2021-01-13T07:50:00\",    \"FinishTime\": \"2021-01-13T11:50:00\",    \"LaborSpan\": \"04:00:00\",    \"TaskId\": 22520168,    \"TaskTitle\": \"Изучить проект ТАУ-2 Геркулес\",    \"ProjectId\": 724230,    \"ProjectTitle\": \"3333-1 ИПР отдела ОПиСИ\"  },  {    \"FirstName\": \"Алексей\",    \"LastName\": \"Евлеев\",    \"StartTime\": \"2021-01-13T12:20:00\",    \"FinishTime\": \"2021-01-13T16:20:00\",    \"LaborSpan\": \"04:00:00\",    \"TaskId\": 22520168,    \"TaskTitle\": \"Изучить проект ТАУ-2 Геркулес\",    \"ProjectId\": 724230,    \"ProjectTitle\": \"3333-1 ИПР отдела ОПиСИ\"  },  {    \"FirstName\": \"Виталий\",    \"LastName\": \"Тимохов\",    \"StartTime\": \"2021-01-12T08:00:00\",    \"FinishTime\": \"2021-01-12T16:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22519808,    \"TaskTitle\": \"Диспетчеризация разведочно-эксплутационной скважины в р.п. Нововаршавка Омской области.\",    \"ProjectId\": 724436,    \"ProjectTitle\": \"АС00-214 Диспетчеризация скважины\"  },  {    \"FirstName\": \"Виталий\",    \"LastName\": \"Тимохов\",    \"StartTime\": \"2021-01-13T08:00:00\",    \"FinishTime\": \"2021-01-13T16:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22519808,    \"TaskTitle\": \"Диспетчеризация разведочно-эксплутационной скважины в р.п. Нововаршавка Омской области.\",    \"ProjectId\": 724436,    \"ProjectTitle\": \"АС00-214 Диспетчеризация скважины\"  },  {    \"FirstName\": \"Наталья\",    \"LastName\": \"Скакун\",    \"StartTime\": \"2021-01-13T08:00:00\",    \"FinishTime\": \"2021-01-13T16:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22514030,    \"TaskTitle\": \"Заполнение шаблонов установки 43-103 часть 2\",    \"ProjectId\": 723794,    \"ProjectTitle\": \"АС00-2 Формирование актуальной базы приборов КИП\"  },  {    \"FirstName\": \"Мейрам\",    \"LastName\": \"Бисимбеков\",    \"StartTime\": \"2021-01-13T15:30:00\",    \"FinishTime\": \"2021-01-13T20:30:00\",    \"LaborSpan\": \"05:00:00\",    \"TaskId\": 22508538,    \"TaskTitle\": \"Разработать программного кода Системы взвешивания и погрузки на вагонных весах установки замедленного коксования\",    \"ProjectId\": 723774,    \"ProjectTitle\": \"0402-1 Взвешивание 21/10 (УЗК), УПНК ОНПЗ\"  },  {    \"FirstName\": \"Талгат\",    \"LastName\": \"Ракишев\",    \"StartTime\": \"2021-01-12T09:00:00\",    \"FinishTime\": \"2021-01-12T17:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22519532,    \"TaskTitle\": \"Доработать ППО\",    \"ProjectId\": 724226,    \"ProjectTitle\": \"АС00-104. Поставка, монтаж и ПНР автоматизированных систем ПАЗ АХУ-1 и АХУ-2\"  },  {    \"FirstName\": \"Талгат\",    \"LastName\": \"Ракишев\",    \"StartTime\": \"2021-01-13T09:00:00\",    \"FinishTime\": \"2021-01-13T17:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22519532,    \"TaskTitle\": \"Доработать ППО\",    \"ProjectId\": 724226,    \"ProjectTitle\": \"АС00-104. Поставка, монтаж и ПНР автоматизированных систем ПАЗ АХУ-1 и АХУ-2\"  },  {    \"FirstName\": \"Талгат\",    \"LastName\": \"Ракишев\",    \"StartTime\": \"2021-01-14T09:00:00\",    \"FinishTime\": \"2021-01-14T17:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22519532,    \"TaskTitle\": \"Доработать ППО\",    \"ProjectId\": 724226,    \"ProjectTitle\": \"АС00-104. Поставка, монтаж и ПНР автоматизированных систем ПАЗ АХУ-1 и АХУ-2\"  },  {    \"FirstName\": \"Алексей\",    \"LastName\": \"Евлеев\",    \"StartTime\": \"2021-01-14T07:55:00\",    \"FinishTime\": \"2021-01-14T11:55:00\",    \"LaborSpan\": \"04:00:00\",    \"TaskId\": 22519662,    \"TaskTitle\": \"Разработать ППО часть 3\",    \"ProjectId\": 724236,    \"ProjectTitle\": \"АС00-124 Линия ввода зерна\"  },  {    \"FirstName\": \"Алексей\",    \"LastName\": \"Евлеев\",    \"StartTime\": \"2021-01-14T12:25:00\",    \"FinishTime\": \"2021-01-14T16:25:00\",    \"LaborSpan\": \"04:00:00\",    \"TaskId\": 22519662,    \"TaskTitle\": \"Разработать ППО часть 3\",    \"ProjectId\": 724236,    \"ProjectTitle\": \"АС00-124 Линия ввода зерна\"  },  {    \"FirstName\": \"Мейрам\",    \"LastName\": \"Бисимбеков\",    \"StartTime\": \"2021-01-14T09:00:00\",    \"FinishTime\": \"2021-01-14T16:00:00\",    \"LaborSpan\": \"07:00:00\",    \"TaskId\": 22508538,    \"TaskTitle\": \"Разработать программного кода Системы взвешивания и погрузки на вагонных весах установки замедленного коксования\",    \"ProjectId\": 723774,    \"ProjectTitle\": \"0402-1 Взвешивание 21/10 (УЗК), УПНК ОНПЗ\"  },  {    \"FirstName\": \"Наталья\",    \"LastName\": \"Скакун\",    \"StartTime\": \"2021-01-14T08:00:00\",    \"FinishTime\": \"2021-01-14T16:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22514030,    \"TaskTitle\": \"Заполнение шаблонов установки 43-103 часть 2\",    \"ProjectId\": 723794,    \"ProjectTitle\": \"АС00-2 Формирование актуальной базы приборов КИП\"  },  {    \"FirstName\": \"Владислав\",    \"LastName\": \"Сузенко\",    \"StartTime\": \"2021-01-13T09:00:00\",    \"FinishTime\": \"2021-01-13T17:30:00\",    \"LaborSpan\": \"08:30:00\",    \"TaskId\": 22509820,    \"TaskTitle\": \"Произвести тестирование программного обеспечения\",    \"ProjectId\": 713482,    \"ProjectTitle\": \"2606-1 Система умного отвешивания\"  },  {    \"FirstName\": \"Владислав\",    \"LastName\": \"Сузенко\",    \"StartTime\": \"2021-01-14T09:15:00\",    \"FinishTime\": \"2021-01-14T17:25:00\",    \"LaborSpan\": \"08:10:00\",    \"TaskId\": 22509820,    \"TaskTitle\": \"Произвести тестирование программного обеспечения\",    \"ProjectId\": 713482,    \"ProjectTitle\": \"2606-1 Система умного отвешивания\"  },  {    \"FirstName\": \"Виталий\",    \"LastName\": \"Тимохов\",    \"StartTime\": \"2021-01-14T08:00:00\",    \"FinishTime\": \"2021-01-14T16:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22519808,    \"TaskTitle\": \"Диспетчеризация разведочно-эксплутационной скважины в р.п. Нововаршавка Омской области.\",    \"ProjectId\": 724436,    \"ProjectTitle\": \"АС00-214 Диспетчеризация скважины\"  },  {    \"FirstName\": \"Виталий\",    \"LastName\": \"Тимохов\",    \"StartTime\": \"2021-01-15T08:00:00\",    \"FinishTime\": \"2021-01-15T16:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22519808,    \"TaskTitle\": \"Диспетчеризация разведочно-эксплутационной скважины в р.п. Нововаршавка Омской области.\",    \"ProjectId\": 724436,    \"ProjectTitle\": \"АС00-214 Диспетчеризация скважины\"  },  {    \"FirstName\": \"Наталья\",    \"LastName\": \"Скакун\",    \"StartTime\": \"2021-01-15T08:00:00\",    \"FinishTime\": \"2021-01-15T16:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22514030,    \"TaskTitle\": \"Заполнение шаблонов установки 43-103 часть 2\",    \"ProjectId\": 723794,    \"ProjectTitle\": \"АС00-2 Формирование актуальной базы приборов КИП\"  },  {    \"FirstName\": \"Мейрам\",    \"LastName\": \"Бисимбеков\",    \"StartTime\": \"2021-01-15T08:00:00\",    \"FinishTime\": \"2021-01-15T19:00:00\",    \"LaborSpan\": \"11:00:00\",    \"TaskId\": 22515736,    \"TaskTitle\": \"Произвести тестирование программного обеспечения\",    \"ProjectId\": 724236,    \"ProjectTitle\": \"АС00-124 Линия ввода зерна\"  },  {    \"FirstName\": \"Алексей\",    \"LastName\": \"Евлеев\",    \"StartTime\": \"2021-01-15T08:00:00\",    \"FinishTime\": \"2021-01-15T16:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22513810,    \"TaskTitle\": \"Установка расходомера на водоблоке \\\"127 ООО \\\"Полиом\\\"\",    \"ProjectId\": 723902,    \"ProjectTitle\": \"АС00-26 Установка коммерческого прибора учёта тепловой энергии на ввод системы отопления Водоблока № 127 ООО \\\"Полиом\\\"\"  },  {    \"FirstName\": \"Талгат\",    \"LastName\": \"Ракишев\",    \"StartTime\": \"2021-01-15T08:00:00\",    \"FinishTime\": \"2021-01-15T16:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22517580,    \"TaskTitle\": \"WinCC OA. Собственный Web-клиент\",    \"ProjectId\": 724230,    \"ProjectTitle\": \"3333-1 ИПР отдела ОПиСИ\"  },  {    \"FirstName\": \"Талгат\",    \"LastName\": \"Ракишев\",    \"StartTime\": \"2021-01-18T08:00:00\",    \"FinishTime\": \"2021-01-18T16:00:00\",    \"LaborSpan\": \"08:00:00\",    \"TaskId\": 22517580,    \"TaskTitle\": \"WinCC OA. Собственный Web-клиент\",    \"ProjectId\": 724230,    \"ProjectTitle\": \"3333-1 ИПР отдела ОПиСИ\"  }]\n";
            p.destroy() ;
            System.out.println(str);
            Gson gson = new Gson();
            Type listType = new TypeToken<ArrayList<PlanfixLaborRecord>>(){}.getType();
            return gson.fromJson(str.toString(), listType);
        }
        catch(Exception exc)
        {
            throw new ServerException(ErrorCode.PLANFIX_CANT_GET_HOURS);
        }
    }
}
